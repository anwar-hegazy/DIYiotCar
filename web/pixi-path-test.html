<!DOCTYPE HTML>
<html>
<head>
    <title>pixi.js example 1</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
        }
    </style>
	<script src="js/pixi.min.js"></script>
</head>
<body>
    <script>
	
var renderer = PIXI.autoDetectRenderer(800, 600);
document.body.appendChild(renderer.view);

// create the root of the scene graph
var stage = new PIXI.Container();
stage.interactive = true;

var pointMeshX=[0];
var pointMeshY=[0];

// create a texture from an image path
var texture = PIXI.Texture.fromImage('_assets/bunny.png');


var pathArea = new PIXI.Graphics();
	pathArea.lineStyle(0);
    pathArea.beginFill(0xFFFFFF, 0.2);
    pathArea.drawRect (0, 0, 800, 600);
	pathArea.visible=true;
	pathArea.interactive = true;
 	stage.addChild(pathArea);

    
	pathArea.click = function(event)
	{    
     this.data = event.data;
     var newPosition = this.data.getLocalPosition(this.parent);
     createAnchor(Math.floor(newPosition.x), Math.floor(newPosition.y)); 
 	 console.log(newPosition.x, newPosition.y);      
    }
  

var pathLine = new PIXI.Graphics();
	stage.addChild(pathLine);


requestAnimationFrame( animate );
  
// *************************************END BODY***********************

function animate() {

         
    requestAnimationFrame(animate);
	
    // render the stage
    renderer.render(stage);
}



function createAnchor(x, y)
{
    // create our little bunny friend..
    var  anchorP = new PIXI.Sprite(texture);
  
	pointMeshX.push(x);
    pointMeshY.push(y);

console.log(pointMeshX.length + "  X/Y "+x+" / "+y);
  
    // enable the bunny to be interactive... this will allow it to respond to mouse and touch events
     anchorP.interactive = true;

    // this button mode will mean the hand cursor appears when you roll over the bunny with your mouse
     anchorP.buttonMode = true;

    // center the bunny's anchor point
     anchorP.anchor.set(0.5);

    // make it a bit bigger, so it's easier to grab
    // bunny.scale.set(3);

    // setup events
     anchorP
        // events for drag start
        .on('mousedown', onDragStart)
        .on('touchstart', onDragStart)
        // events for drag end
        .on('mouseup', onDragEnd)
        .on('mouseupoutside', onDragEnd)
        .on('touchend', onDragEnd)
        .on('touchendoutside', onDragEnd)
        // events for drag move
        .on('mousemove', onDragMove)
        .on('touchmove', onDragMove);

    // move the sprite to its designated position
     anchorP.position.x = x;
     anchorP.position.y = y;

    // add it to the stage
    stage.addChildAt(anchorP,pointMeshX.length); //*******************
   drawPath();
  
   
}


function onDragStart(event)
{
    // store a reference to the data
    // the reason for this is because of multitouch
    // we want to track the movement of this particular touch
    this.data = event.data;
    this.alpha = 0.5;
    this.dragging = true;
  
}

function onDragEnd()
{
    this.alpha = 1;
    this.dragging = false;
    // set the interaction data to null
    this.data = null;
  	
}

function onDragMove()
{
    if (this.dragging)
    {
        var newPosition = this.data.getLocalPosition(this.parent);
        this.position.x = newPosition.x;
        this.position.y = newPosition.y;
     
    }
}



function drawPath() 
{
	//pathLine.clear();
  
  	console.log(pointMeshX.length); 
  
  	
  
    if (pointMeshX.length > 3) {
      var index = pointMeshX.length; 
     console.log("inside loop");
    pathLine.lineStyle(2, 0x33FF00); 
    pathLine.moveTo(pointMeshX[index-2],pointMeshY[index-2]); 
	pathLine.lineTo(pointMeshX[index-1],pointMeshY[index-1]); 
    stage.addChild(pathLine);
    }
//   for (var i=2; i=pointMeshX.length-1; i++)
		
//  	{ 
      
//	pathLine.moveTo(pointMeshX[i-1],pointMeshY[i-1]); 
//	pathLine.lineTo(pointMeshX[i],pointMeshY[i]); 
    
}

</script>
 
    </body>
</html>
